<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PROJECT_TITLE}} - Hetland</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../styles/colors.css">
    <link rel="stylesheet" href="../../styles/selection.css">
    <link rel="stylesheet" href="../ProjectTemplate/project-template.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="../../services/GLTFLoader.js"></script>
    <script src="../../services/sceneManager.js"></script>
    <script src="../../services/cameraMovement.js"></script>
    <script src="../../services/oceanBackground.js"></script>
    <script src="../../services/submarine.js"></script>
    <script src="../../services/kelp.js"></script>
    <script src="../../services/header.js"></script>
    <script src="../../services/colorConfigPanel.js"></script>
</head>
<body>
    <!-- 3D Background Elements -->
    <canvas id="canvas3d"></canvas>
    <div class="fog-overlay"></div>
    <div class="cursor-light" id="cursorLight"></div>
    <div class="vignette"></div>
    
    <!-- Navigation Header -->
    <header class="project-header">
        <nav class="project-nav">
            <a href="../../index.html" class="nav-link">
                <i class="fas fa-home"></i>
                Home
            </a>
            <a href="../index.html" class="nav-link">
                <i class="fas fa-arrow-left"></i>
                Projects
            </a>
        </nav>
    </header>
    
    <!-- Main Content -->
    <div class="content">
        <!-- Hero Section -->
        <section class="project-hero">
            <div class="hero-image-container">
                <img src="{{PROJECT_IMAGE}}" alt="{{PROJECT_TITLE}}" class="hero-image">
                <div class="hero-overlay">
                    <div class="project-badges">
                        <span class="status-badge status-{{PROJECT_STATUS_LOWER}}">{{PROJECT_STATUS}}</span>
                        {{PROJECT_TAGS_BADGES}}
                    </div>
                </div>
            </div>
            <div class="hero-content">
                <h1 class="project-title">{{PROJECT_TITLE}}</h1>
                <p class="project-subtitle">{{PROJECT_SUBTITLE}}</p>
                <div class="project-meta">
                    <div class="meta-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>{{PROJECT_DATE}}</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-code"></i>
                        <span>{{PROJECT_TECHNOLOGIES}}</span>
                    </div>
                </div>
                <div class="hero-actions">
                    {{PROJECT_ACTIONS}}
                </div>
            </div>
        </section>
        
        <!-- Project Description -->
        <section class="project-section">
            <h2 class="section-title">About This Project</h2>
            <div class="section-content">
                {{PROJECT_DESCRIPTION}}
            </div>
        </section>
        
        <!-- Features Section -->
        <section class="project-section features-section">
            <h2 class="section-title">Key Features</h2>
            <div class="features-grid">
                {{PROJECT_FEATURES}}
            </div>
        </section>
        
        <!-- Screenshots/Media Section -->
        <section class="project-section media-section">
            <h2 class="section-title">Screenshots & Media</h2>
            <div class="media-gallery">
                {{PROJECT_MEDIA}}
            </div>
        </section>
        
        <!-- Technical Details Section -->
        <section class="project-section technical-section">
            <h2 class="section-title">Technical Details</h2>
            <div class="technical-grid">
                {{PROJECT_TECHNICAL_DETAILS}}
            </div>
        </section>
        
        <!-- Challenges & Solutions Section -->
        <section class="project-section challenges-section">
            <h2 class="section-title">Challenges & Solutions</h2>
            <div class="challenges-content">
                {{PROJECT_CHALLENGES}}
            </div>
        </section>
        
        <!-- Footer Actions -->
        <section class="project-footer">
            <div class="footer-actions">
                {{PROJECT_FOOTER_ACTIONS}}
            </div>
            <div class="project-navigation">
                <a href="../index.html" class="nav-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Projects
                </a>
                <!-- Additional navigation links can be added here -->
            </div>
        </section>
    </div>

    <script>
        // Initialize 3D background systems
        window.addEventListener('load', () => {
            // Mobile detection
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                            window.innerWidth <= 768;
            const isLowEndDevice = navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 4;
            
            // Initialize core systems
            const sceneManager = new SceneManager();
            const cameraMovement = new CameraMovement();
            
            // Get scene references
            const scene = sceneManager.getScene();
            const camera = sceneManager.getCamera();
            
            // Initialize background systems
            const oceanOptions = {
                enableScrollCameraMovement: true,
                cameraMovement: cameraMovement,
                sceneManager: sceneManager
            };
            
            const oceanBackground = new OceanBackground(scene, camera, oceanOptions);
            const submarine = new Submarine(scene, camera);
            const kelp = new Kelp(scene);
            
            // Register camera for parallax movement
            cameraMovement.addCamera(camera, 0.5);
            
            // Cursor light handling
            const cursorLight = document.getElementById('cursorLight');
            let touchActive = false;
            
            if (isMobile) {
                cursorLight.style.opacity = '0';
                
                document.addEventListener('touchstart', (e) => {
                    touchActive = true;
                    cursorLight.style.opacity = '0.8';
                    const touch = e.touches[0];
                    cursorLight.style.left = touch.clientX + 'px';
                    cursorLight.style.top = touch.clientY + 'px';
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (touchActive) {
                        const touch = e.touches[0];
                        cursorLight.style.left = touch.clientX + 'px';
                        cursorLight.style.top = touch.clientY + 'px';
                    }
                });
                
                document.addEventListener('touchend', () => {
                    touchActive = false;
                    setTimeout(() => {
                        if (!touchActive) {
                            cursorLight.style.opacity = '0';
                        }
                    }, 500);
                });
            } else {
                document.addEventListener('mousemove', (e) => {
                    cursorLight.style.left = e.clientX + 'px';
                    cursorLight.style.top = e.clientY + 'px';
                    cursorLight.style.opacity = '1';
                });
                
                document.addEventListener('mouseleave', () => {
                    cursorLight.style.opacity = '0';
                });
            }
            
            // Mobile scroll optimization
            let isScrolling = false;
            let scrollTimeout;
            let animationPaused = false;
            
            if (isMobile) {
                window.addEventListener('scroll', () => {
                    if (!isScrolling) {
                        isScrolling = true;
                        animationPaused = true;
                        
                        const canvas = document.getElementById('canvas3d');
                        if (canvas) {
                            canvas.style.opacity = '0.3';
                        }
                    }
                    
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        isScrolling = false;
                        animationPaused = false;
                        
                        const canvas = document.getElementById('canvas3d');
                        if (canvas) {
                            canvas.style.opacity = '0.7';
                        }
                    }, 150);
                }, { passive: true });
            }
            
            // Add systems to scene manager
            sceneManager.addSystem({
                update: () => {
                    try {
                        if (isMobile && animationPaused) {
                            return;
                        }
                        
                        if (!cameraMovement || !oceanBackground || !submarine || !kelp) {
                            return;
                        }
                        
                        const mousePos = cameraMovement.getMousePosition();
                        
                        if (!mousePos || typeof mousePos.x !== 'number' || typeof mousePos.y !== 'number') {
                            return;
                        }
                        
                        if (oceanBackground.updateMousePosition) {
                            oceanBackground.updateMousePosition(mousePos.x, mousePos.y);
                        }
                        if (oceanBackground.update) {
                            oceanBackground.update();
                        }
                        
                        if (submarine.updateMousePosition) {
                            submarine.updateMousePosition(mousePos.x, mousePos.y);
                        }
                        if (submarine.update) {
                            submarine.update();
                        }
                        
                        if (kelp.update) {
                            kelp.update();
                        }
                        
                        if (cameraMovement.update) {
                            cameraMovement.update();
                        }
                    } catch (error) {
                        console.error('Error in animation loop:', error);
                    }
                }
            });
            
            // Start animation loop
            if (isLowEndDevice && navigator.hardwareConcurrency <= 2) {
                let lastFrame = 0;
                const targetFPS = 30;
                const frameDelay = 1000 / targetFPS;
                
                let animationId;
                const throttledUpdate = (time) => {
                    if (time - lastFrame >= frameDelay) {
                        if (sceneManager.render) {
                            sceneManager.render();
                        } else if (sceneManager.update) {
                            sceneManager.update();
                        }
                        lastFrame = time;
                    }
                    
                    if (!document.hidden && !animationPaused) {
                        animationId = requestAnimationFrame(throttledUpdate);
                    }
                };
                
                animationId = requestAnimationFrame(throttledUpdate);
                window.animationId = animationId;
            } else {
                sceneManager.start();
            }
        });
        
        // Image lazy loading and error handling
        document.addEventListener('DOMContentLoaded', () => {
            // Add loading states to images
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('load', () => {
                    img.classList.add('loaded');
                });
                
                img.addEventListener('error', () => {
                    img.classList.add('error');
                    // Could set a fallback image here
                });
            });
            
            // Smooth scroll for anchor links
            const anchorLinks = document.querySelectorAll('a[href^="#"]');
            anchorLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = document.querySelector(link.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>